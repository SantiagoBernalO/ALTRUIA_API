å∞
wC:\Users\asant\OneDrive\Escritorio\Andres Bernal\proyectos\proyectoTEAServicios\proyectoTEAServicios\Datos\Actividad.cs
	namespace 	
Datos
 
{ 
public 

class 
	Actividad 
: 
Mapping $
{ 
public 
List	 
< 
Utest 
> 
enteros 
( 
) 
{ 
return 	
new
 
Mapping 
( 
) 
. 
utest 
. 
ToList $
($ %
)% &
;& '
} 
public 
int 8
,verificarCantidadMaximaActividadesPorDocente ?
(? @

UActividad@ J

actividadEK U
)U V
{ 	
return 
new 
Mapping 
( 
)  
.  !
	actividad! *
.* +
Where+ 0
(0 1
x1 2
=>3 5
(6 7
x7 8
.8 9
Docente_creador9 H
.H I
EqualsI O
(O P

actividadEP Z
.Z [
Docente_creador[ j
)j k
)k l
)l m
.m n
Countn s
(s t
)t u
;u v
} 	
public 
void 
agregarActividad $
($ %

UActividad% /

actividadE0 :
): ;
{ 	
using 
( 
var 
db 
= 
new 
Mapping  '
(' (
)( )
)) *
{ 
db 
. 
	actividad 
. 
Add  
(  !

actividadE! +
)+ ,
;, -
db 
. 
SaveChanges 
( 
)  
;  !
} 
} 	
public!! 
List!! 
<!! 

UActividad!! 
>!! #
listaActividadesDocente!!  7
(!!7 8

UActividad!!8 B
	idDocente!!C L
)!!L M
{"" 	
using## 
(## 
var## 
db## 
=## 
new## 
Mapping##  '
(##' (
)##( )
)##) *
{$$ 
List%% 
<%% 	

UActividad%%	 
>%% 
lista%% 
=%% 
(%% 
from%% "
a%%# $
in%%% '
db%%( *
.%%* +
	actividad%%+ 4
join&& 
tp&& 
in&& 
db&& 
.&& 
uTipoActividads&& )
on&&* ,
a&&- .
.&&. /
Tipo_actividad&&/ =
equals&&> D
tp&&E G
.&&G H
Id_tp_actividad&&H W
where'' 
a'' 
.'' 
Docente_creador'' #
==''$ &
	idDocente''' 0
.''0 1
Docente_creador''1 @
select)) 
new)) 
{** 
a++ 
,++ 
tp,, 
}-- 
)-- 
.-- 
ToList-- 
(-- 
)-- 
.-- 
Select-- 
(-- 
m--  
=>--! #
new--$ '

UActividad--( 2
{.. 
Id_actividad// 
=// 
m// 
.// 
a// 
.//  
Id_actividad//  ,
,//, -
NombreActividad00 
=00 
m00  
.00  !
a00! "
.00" #
NombreActividad00# 2
,002 3
Descripcion11 
=11 
m11 
.11 
a11 
.11 
Descripcion11 *
,11* +
Tipo_actividad22 
=22 
m22 
.22  
a22  !
.22! "
Tipo_actividad22" 0
,220 1
Contenido_actividad33  
=33! "
m33# $
.33$ %
a33% &
.33& '
Contenido_actividad33' :
,33: ; 
Tipo_actividad_texto44 !
=44" #
m44$ %
.44% &
tp44& (
.44( )
ActividadNombre44) 8
,448 9
	Estado_id55 
=55 
m55 
.55 
a55 
.55 
	Estado_id55 &
}66 
)66 
.66 
ToList66 
(66 
)66 
;66 
return77 

lista77 
;77 
}88 
}99 	
public:: 
string::	 )
desactivivarOActivarActividad:: -
(::- .
int::. 1
actividad_id::2 >
)::> ?
{;; 
using<< 
(<<	 

var<<
 
db<< 
=<< 
new<< 
Mapping<< 
(<< 
)<<  
)<<  !
{== 

UActividad??  
actividadAActualizar?? #
=??$ %
db??& (
.??( )
	actividad??) 2
.??2 3
Where??3 8
(??8 9
x??9 :
=>??; =
x??> ?
.??? @
Id_actividad??@ L
.??L M
Equals??M S
(??S T
actividad_id??T `
)??` a
)??a b
.??b c
FirstOrDefault??c q
(??q r
)??r s
;??s t
string@@ 

	respuesta@@ 
=@@ 
$str@@ 6
;@@6 7 
actividadAActualizarAA 
.AA 
	Estado_idAA "
=AA# $ 
actividadAActualizarAA% 9
.AA9 :
	Estado_idAA: C
==AAD F
$numAAG H
?AAI J
$numAAK L
:AAM N
$numAAO P
;AAP Q
	respuestaCC 
=CC  
actividadAActualizarCC $
.CC$ %
	Estado_idCC% .
==CC/ 1
$numCC2 3
?CC4 5
	respuestaCC6 ?
:CC? @
$strCCA c
;CCc d
varEE 
entyEE 
=EE 
dbEE 
.EE 
EntryEE 
(EE  
actividadAActualizarEE ,
)EE, -
;EE- .
entyFF 
.FF 	
StateFF	 
=FF 
EntityStateFF 
.FF 
ModifiedFF %
;FF% &
dbGG 
.GG 
SaveChangesGG 
(GG 
)GG 
;GG 
returnII 

	respuestaII 
;II 
}JJ 
}KK 
publicMM 
stringMM	 )
desactivivar_ActivarCategoriaMM -
(MM- .
intMM. 1
actividad_idMM2 >
)MM> ?
{NN 
usingOO 
(OO	 

varOO
 
dbOO 
=OO 
newOO 
MappingOO 
(OO 
)OO  
)OO  !
{PP $
UActividadPecsCategoriasRR  
categoriaAActualizarRR 1
=RR2 3
dbRR4 6
.RR6 7$
uActividadPecsCategoriasRR7 O
.RRO P
WhereRRP U
(RRU V
xRRV W
=>RRX Z
xRR[ \
.RR\ ]
IdRR] _
.RR_ `
EqualsRR` f
(RRf g
actividad_idRRg s
)RRs t
)RRt u
.RRu v
FirstOrDefault	RRv Ñ
(
RRÑ Ö
)
RRÖ Ü
;
RRÜ á
stringSS 

	respuestaSS 
=SS 
$strSS 6
;SS6 7 
categoriaAActualizarTT 
.TT 
	Estado_idTT "
=TT# $ 
categoriaAActualizarTT% 9
.TT9 :
	Estado_idTT: C
==TTD F
$numTTG H
?TTI J
$numTTK L
:TTM N
$numTTO P
;TTP Q
	respuestaVV 
=VV  
categoriaAActualizarVV $
.VV$ %
	Estado_idVV% .
==VV/ 1
$numVV2 3
?VV4 5
	respuestaVV6 ?
:VV@ A
$strVVB d
;VVd e
varXX 
entyXX 
=XX 
dbXX 
.XX 
EntryXX 
(XX  
categoriaAActualizarXX ,
)XX, -
;XX- .
entyYY 
.YY 	
StateYY	 
=YY 
EntityStateYY 
.YY 
ModifiedYY %
;YY% &
dbZZ 
.ZZ 
SaveChangesZZ 
(ZZ 
)ZZ 
;ZZ 
return\\ 

	respuesta\\ 
;\\ 
}]] 
}^^ 
publicaa 

UActividadaa	 
getActivityIdaa !
(aa! "
intaa" %
activity_idaa& 1
)aa1 2
{bb 
usingcc 
(cc	 

varcc
 
dbcc 
=cc 
newcc 
Mappingcc 
(cc 
)cc  
)cc  !
{dd 
returnff 

dbff 
.ff 
	actividadff 
.ff 
Whereff 
(ff 
xff 
=>ff  "
xff# $
.ff$ %
Id_actividadff% 1
.ff1 2
Equalsff2 8
(ff8 9
activity_idff9 D
)ffD E
)ffE F
.ffF G
FirstOrDefaultffG U
(ffU V
)ffV W
;ffW X
}hh 
}ii 
publickk 
Listkk	 
<kk 
UTipoActividadkk 
>kk 
getTypeActivitykk -
(kk- .
)kk. /
{ll 
returnmm 	
newmm
 
Mappingmm 
(mm 
)mm 
.mm 
uTipoActividadsmm '
.mm' (
ToListmm( .
(mm. /
)mm/ 0
;mm0 1
}nn 
publicqq 
stringqq	 
postActividadqq 
(qq 

UActividadqq (
actividadHechaqq) 7
)qq7 8
{rr 
usingss 
(ss	 

varss
 
dbss 
=ss 
newss 
Mappingss 
(ss 
)ss  
)ss  !
{tt 

UActividaduu 
actividadActualizaruu "
=uu# $
dbuu% '
.uu' (
	actividaduu( 1
.uu1 2
Whereuu2 7
(uu7 8
xuu8 9
=>uu: <
xuu= >
.uu> ?
Id_actividaduu? K
.uuK L
EqualsuuL R
(uuR S
actividadHechauuS a
.uua b
Id_actividaduub n
)uun o
)uuo p
.uup q
FirstOrDefaultuuq 
(	uu Ä
)
uuÄ Å
;
uuÅ Ç
ifvv 
(vv 
actividadActualizarvv 
.vv (
EstudiantesHicieronActividadvv 8
!=vv9 ;
nullvv< @
)vv@ A
{ww 
Listzz 	
<zz	 

PacienteScoreJSonzz
 
>zz "
pacientesEnLaActividadzz 3
=zz4 5
JsonConvertzz6 A
.zzA B
DeserializeObjectzzB S
<zzS T
ListzzT X
<zzX Y
PacienteScoreJSonzzY j
>zzj k
>zzk l
(zzl m 
actividadActualizar	zzm Ä
.
zzÄ Å*
EstudiantesHicieronActividad
zzÅ ù
)
zzù û
;
zzû ü"
pacientesEnLaActividad{{ 
.{{ 
Add{{ 
({{  
actividadHecha{{  .
.{{. /
NuevoEstudiante{{/ >
){{> ?
;{{? @
actividadActualizar}} 
.}} (
EstudiantesHicieronActividad}} 5
=}}6 7
JsonConvert}}8 C
.}}C D
SerializeObject}}D S
(}}S T"
pacientesEnLaActividad}}T j
,}}j k

Formatting}}l v
.}}v w
Indented}}w 
,	}} Ä
new
}}Å Ñ$
JsonSerializerSettings
}}Ö õ
{~~ 
NullValueHandling 
= 
NullValueHandling +
.+ ,
Ignore, 2
}
ÄÄ 
)
ÄÄ 
;
ÄÄ 
}
ÅÅ 
else
ÇÇ 
{
ÉÉ 
List
ÑÑ 	
<
ÑÑ	 

PacienteScoreJSon
ÑÑ
 
>
ÑÑ $
pacientesEnLaActividad
ÑÑ 3
=
ÑÑ4 5
new
ÑÑ6 9
List
ÑÑ: >
<
ÑÑ> ?
PacienteScoreJSon
ÑÑ? P
>
ÑÑP Q
(
ÑÑQ R
)
ÑÑR S
;
ÑÑS T$
pacientesEnLaActividad
ÖÖ 
.
ÖÖ 
Add
ÖÖ 
(
ÖÖ  
actividadHecha
ÖÖ  .
.
ÖÖ. /
NuevoEstudiante
ÖÖ/ >
)
ÖÖ> ?
;
ÖÖ? @!
actividadActualizar
ÜÜ 
.
ÜÜ *
EstudiantesHicieronActividad
ÜÜ 5
=
ÜÜ6 7
JsonConvert
ÜÜ8 C
.
ÜÜC D
SerializeObject
ÜÜD S
(
ÜÜS T$
pacientesEnLaActividad
ÜÜT j
,
ÜÜj k

Formatting
ÜÜl v
.
ÜÜv w
Indented
ÜÜw 
,ÜÜ Ä
newÜÜÅ Ñ&
JsonSerializerSettingsÜÜÖ õ
{
áá 
NullValueHandling
àà 
=
àà 
NullValueHandling
àà +
.
àà+ ,
Ignore
àà, 2
}
ââ 
)
ââ 
;
ââ 
}
ää 
var
ãã 
enty
ãã 
=
ãã 
db
ãã 
.
ãã 
Entry
ãã 
(
ãã !
actividadActualizar
ãã +
)
ãã+ ,
;
ãã, -
enty
åå 
.
åå 	
State
åå	 
=
åå 
EntityState
åå 
.
åå 
Modified
åå %
;
åå% &
db
çç 
.
çç 
SaveChanges
çç 
(
çç 
)
çç 
;
çç 
return
éé 

$str
éé ;
;
éé; <
}
èè 
}
êê 
public
ìì 
List
ìì	 
<
ìì 
	UPaciente
ìì 
>
ìì 1
#getAcivitysDidByPatientForAttendant
ìì <
(
ìì< =
int
ìì= @
id_activity
ììA L
,
ììL M
String
ììM S
id_card_patient
ììT c
)
ììc d
{
îî 

UActividad
ïï 
activityDid
ïï 
=
ïï 
new
ïï 
Mapping
ïï  '
(
ïï' (
)
ïï( )
.
ïï) *
	actividad
ïï* 3
.
ïï3 4
Where
ïï4 9
(
ïï9 :
x
ïï: ;
=>
ïï< >
x
ïï? @
.
ïï@ A
Id_actividad
ïïA M
.
ïïM N
Equals
ïïN T
(
ïïT U
id_activity
ïïU `
)
ïï` a
)
ïïa b
.
ïïb c
FirstOrDefault
ïïc q
(
ïïq r
)
ïïr s
;
ïïs t
List
ññ 
<
ññ 
PacienteScoreJSon
ññ 
>
ññ "
patientInTheActivity
ññ /
=
ññ0 1
new
ññ2 5
List
ññ6 :
<
ññ: ;
PacienteScoreJSon
ññ; L
>
ññL M
(
ññM N
)
ññN O
;
ññO P
List
óó 
<
óó 
	UPaciente
óó 
>
óó 
pacient
óó 
=
óó 
new
óó  
List
óó! %
<
óó% &
	UPaciente
óó& /
>
óó/ 0
(
óó0 1
)
óó1 2
;
óó2 3
if
òò 
(
òò 
activityDid
òò 
.
òò *
EstudiantesHicieronActividad
òò /
!=
òò/ 1
null
òò1 5
)
òò5 6
{
ôô "
patientInTheActivity
öö 
=
öö 
JsonConvert
õõ 
.
õõ 
DeserializeObject
õõ !
<
õõ! "
List
õõ" &
<
õõ& '
PacienteScoreJSon
õõ' 8
>
õõ8 9
>
õõ9 :
(
õõ: ;
activityDid
õõ; F
.
õõF G*
EstudiantesHicieronActividad
õõG c
)
õõc d
;
õõd e"
patientInTheActivity
úú 
=
úú "
patientInTheActivity
úú /
.
úú/ 0
Where
úú0 5
(
úú5 6
x
úú6 7
=>
úú8 :
x
úú; <
.
úú< =
DocumentoPaciente
úú= N
.
úúN O
Equals
úúO U
(
úúU V
id_card_patient
úúV e
)
úúe f
)
úúf g
.
úúg h
ToList
úúh n
(
úún o
)
úúo p
;
úúp q
pacient
ùù 
=
ùù "
patientInTheActivity
ùù "
!=
ùù# %
null
ùù& *
?
ùù+ ,
new
ùù- 0
Mapping
ùù1 8
(
ùù8 9
)
ùù9 :
.
ùù: ;
paciente
ùù; C
.
ùùC D
Where
ùùD I
(
ùùI J
x
ùùJ K
=>
ùùL N
x
ùùO P
.
ùùP Q
	Documento
ùùQ Z
==
ùù[ ]
id_card_patient
ùù^ m
)
ùùm n
.
ùùn o
ToList
ùùo u
(
ùùu v
)
ùùv w
:
ùùw x
null
ûû 	
;
ûû	 

}
üü 
else
†† 
{
°° 
pacient
¢¢ 
=
¢¢ 
null
¢¢ 
;
¢¢ 
}
££ 
return
§§ 	
pacient
§§
 
;
§§ 
}
•• 
public
ßß 
List
ßß	 
<
ßß 
	UPaciente
ßß 
>
ßß /
!getAcivitysDidByPatientForTeacher
ßß :
(
ßß: ;
int
ßß; >
id_activity
ßß? J
,
ßßJ K
string
ßßL R
id_card_teacher
ßßS b
)
ßßb c
{
®® 

UActividad
©© 
activityDid
©© 
=
©© 
new
©© 
Mapping
©©  '
(
©©' (
)
©©( )
.
©©) *
	actividad
©©* 3
.
©©3 4
Where
©©4 9
(
©©9 :
x
©©: ;
=>
©©< >
x
©©? @
.
©©@ A
Id_actividad
©©A M
.
©©M N
Equals
©©N T
(
©©T U
id_activity
©©U `
)
©©` a
)
©©a b
.
©©b c
FirstOrDefault
©©c q
(
©©q r
)
©©r s
;
©©s t
List
™™ 
<
™™ 
PacienteScoreJSon
™™ 
>
™™ "
patientInTheActivity
™™ /
=
™™0 1
new
™™2 5
List
™™6 :
<
™™: ;
PacienteScoreJSon
™™; L
>
™™L M
(
™™M N
)
™™N O
;
™™O P
List
´´ 
<
´´ 
	UPaciente
´´ 
>
´´ !
patientsDidActivity
´´ &
=
´´' (
new
´´) ,
List
´´- 1
<
´´1 2
	UPaciente
´´2 ;
>
´´; <
(
´´< =
)
´´= >
;
´´> ?
if
¨¨ 
(
¨¨ 
activityDid
¨¨ 
.
¨¨ *
EstudiantesHicieronActividad
¨¨ /
!=
¨¨0 2
null
¨¨3 7
)
¨¨7 8
{
≠≠ "
patientInTheActivity
ÆÆ 
=
ÆÆ 
JsonConvert
ØØ 
.
ØØ 
DeserializeObject
ØØ !
<
ØØ! "
List
ØØ" &
<
ØØ& '
PacienteScoreJSon
ØØ' 8
>
ØØ8 9
>
ØØ9 :
(
ØØ: ;
activityDid
ØØ; F
.
ØØF G*
EstudiantesHicieronActividad
ØØG c
)
ØØc d
;
ØØd e
foreach
∞∞ 
(
∞∞ 
	UPaciente
∞∞ 
patient
∞∞ 
in
∞∞  
new
∞∞! $
Mapping
∞∞% ,
(
∞∞, -
)
∞∞- .
.
∞∞. /
paciente
∞∞/ 7
.
∞∞7 8
Where
∞∞8 =
(
∞∞= >
x
∞∞> ?
=>
∞∞@ B
x
∞∞C D
.
∞∞D E
Documento_docente
∞∞E V
.
∞∞V W
Equals
∞∞W ]
(
∞∞] ^
id_card_teacher
∞∞^ m
)
∞∞m n
)
∞∞n o
.
∞∞o p
ToList
∞∞p v
(
∞∞v w
)
∞∞w x
)
∞∞x y
{
±± 
if
≤≤ 
(
≤≤ 	"
patientInTheActivity
≤≤	 
.
≤≤ 
Where
≤≤ #
(
≤≤# $
x
≤≤$ %
=>
≤≤% '
x
≤≤' (
.
≤≤( )
DocumentoPaciente
≤≤) :
.
≤≤: ;
Equals
≤≤; A
(
≤≤A B
patient
≤≤B I
.
≤≤I J
	Documento
≤≤J S
)
≤≤S T
)
≤≤T U
.
≤≤U V
FirstOrDefault
≤≤V d
(
≤≤d e
)
≤≤e f
!=
≤≤f h
null
≤≤h l
)
≤≤l m
{
≥≥ !
patientsDidActivity
¥¥ 
.
¥¥ 
Add
¥¥ 
(
¥¥ 
patient
¥¥ %
)
¥¥% &
;
¥¥& '
}
µµ 
}
∂∂ 
}
∏∏ 
else
ππ 
{
∫∫ !
patientsDidActivity
ªª 
=
ªª 
null
ªª 
;
ªª 
}
ºº 
if
ΩΩ 
(
ΩΩ !
patientsDidActivity
ΩΩ 
.
ΩΩ 
Count
ΩΩ  
<
ΩΩ! "
$num
ΩΩ# $
)
ΩΩ$ %
{
ææ !
patientsDidActivity
øø 
=
øø 
null
øø 
;
øø 
}
¿¿ 
return
¡¡ 	!
patientsDidActivity
¡¡
 
;
¡¡ 
}
¬¬ 
public
√√ 
List
√√	 
<
√√ 
	UPaciente
√√ 
>
√√ $
patienteMakeEvaluation
√√ /
(
√√/ 0
)
√√0 1
{
ƒƒ 
List
≈≈ 
<
≈≈ 
	UPaciente
≈≈ 
>
≈≈ #
patientMakeEvaluation
≈≈ (
=
≈≈) *
new
≈≈+ .
List
≈≈/ 3
<
≈≈3 4
	UPaciente
≈≈4 =
>
≈≈= >
(
≈≈> ?
)
≈≈? @
;
≈≈@ A
List
∆∆ 
<
∆∆ )
UResultadoEvaluacionInicial
∆∆ #
>
∆∆# $
patients
∆∆% -
=
∆∆. /
new
∆∆0 3
List
∆∆4 8
<
∆∆8 9)
UResultadoEvaluacionInicial
∆∆9 T
>
∆∆T U
(
∆∆U V
)
∆∆V W
;
∆∆W X
using
»» 
(
»»	 

var
»»
 
db
»» 
=
»» 
new
»» 
Mapping
»» 
(
»» 
)
»»  
)
»»  !
{
…… 
patients
   
=
   
new
   
HashSet
   
<
   )
UResultadoEvaluacionInicial
   6
>
  6 7
(
  7 8
db
  8 :
.
  : ;1
#resultadoActividadEvaluacionInicial
  ; ^
.
  ^ _
ToList
  _ e
(
  e f
)
  f g
)
  g h
.
  h i
ToList
  i o
(
  o p
)
  p q
;
  q r
foreach
ÃÃ 
(
ÃÃ 
var
ÃÃ 
patient
ÃÃ 
in
ÃÃ 
patients
ÃÃ #
)
ÃÃ# $
{
ÕÕ 
if
ŒŒ 
(
ŒŒ 	#
patientMakeEvaluation
ŒŒ	 
.
ŒŒ 
Where
ŒŒ $
(
ŒŒ$ %
x
ŒŒ% &
=>
ŒŒ& (
x
ŒŒ( )
.
ŒŒ) *
	Documento
ŒŒ* 3
==
ŒŒ4 6
patient
ŒŒ7 >
.
ŒŒ> ?

Id_usuario
ŒŒ? I
)
ŒŒI J
.
ŒŒJ K
FirstOrDefault
ŒŒK Y
(
ŒŒY Z
)
ŒŒZ [
==
ŒŒ\ ^
null
ŒŒ_ c
)
ŒŒc d
{
œœ #
patientMakeEvaluation
–– 
.
–– 
Add
–– 
(
––  
db
––  "
.
––" #
paciente
––# +
.
––+ ,
Where
––, 1
(
––1 2
x
––2 3
=>
––4 6
x
––7 8
.
––8 9
	Documento
––9 B
.
––B C
Equals
––C I
(
––I J
patient
––J Q
.
––Q R

Id_usuario
––R \
)
––\ ]
)
––] ^
.
––^ _
FirstOrDefault
––_ m
(
––m n
)
––n o
)
––o p
;
––p q
}
—— 
}
““ 
return
”” 
#
patientMakeEvaluation
””  
;
””  !
}
‘‘ 
}
’’ 
public
◊◊ 
List
◊◊	 
<
◊◊ )
UResultadoEvaluacionInicial
◊◊ )
>
◊◊) *%
patienteScoreEvaluation
◊◊+ B
(
◊◊B C
string
◊◊C I
id_card_patient
◊◊J Y
)
◊◊Y Z
{
ÿÿ 
using
ŸŸ 
(
ŸŸ	 

var
ŸŸ
 
db
ŸŸ 
=
ŸŸ 
new
ŸŸ 
Mapping
ŸŸ 
(
ŸŸ 
)
ŸŸ  
)
ŸŸ  !
{
⁄⁄ 
return
‹‹ 

db
‹‹ 
.
‹‹ 1
#resultadoActividadEvaluacionInicial
‹‹ 1
.
‹‹1 2
Where
‹‹2 7
(
‹‹7 8
x
‹‹8 9
=>
‹‹9 ;
x
‹‹; <
.
‹‹< =

Id_usuario
‹‹= G
.
‹‹G H
Equals
‹‹H N
(
‹‹N O
id_card_patient
‹‹O ^
)
‹‹^ _
)
‹‹_ `
.
‹‹` a
ToList
‹‹a g
(
‹‹g h
)
‹‹h i
;
‹‹i j
}
›› 
}
ﬁﬁ 
public
‡‡ 
List
‡‡	 
<
‡‡  
UEvaluacionInicial
‡‡  
>
‡‡  !1
#getListActivitysToInicialEvaluation
‡‡" E
(
‡‡E F
int
‡‡F I
[
‡‡I J
]
‡‡J K
	id_random
‡‡L U
,
‡‡U V
int
‡‡V Y
identificador
‡‡Z g
)
‡‡g h
{
··  
UEvaluacionInicial
‚‚ 
[
‚‚ 
]
‚‚ 
activity
‚‚  
=
‚‚! "
new
‚‚# & 
UEvaluacionInicial
‚‚' 9
[
‚‚9 :
	id_random
‚‚: C
.
‚‚C D
Length
‚‚D J
]
‚‚J K
;
‚‚K L
List
„„ 
<
„„  
UEvaluacionInicial
„„ 
>
„„ 
activityList
„„ (
=
„„) *
new
„„+ .
List
„„/ 3
<
„„3 4 
UEvaluacionInicial
„„4 F
>
„„F G
(
„„G H
)
„„H I
;
„„I J
int
‰‰ 
primero
‰‰ 
=
‰‰ 
	id_random
‰‰ 
[
‰‰ 
$num
‰‰ 
]
‰‰ 
;
‰‰ 
int
ÂÂ 
segundo
ÂÂ 
=
ÂÂ 
	id_random
ÂÂ 
[
ÂÂ 
$num
ÂÂ 
]
ÂÂ 
;
ÂÂ 
int
ÊÊ 
tercero
ÊÊ 
=
ÊÊ 
	id_random
ÊÊ 
[
ÊÊ 
$num
ÊÊ 
]
ÊÊ 
;
ÊÊ 
activity
ÁÁ 
[
ÁÁ 
$num
ÁÁ 
]
ÁÁ 
=
ÁÁ 
new
ÁÁ 
Mapping
ÁÁ 
(
ÁÁ 
)
ÁÁ 
.
ÁÁ (
actividadEvaluacionInicial
ÁÁ 9
.
ÁÁ9 :
Where
ÁÁ: ?
(
ÁÁ? @
x
ÁÁ@ A
=>
ÁÁB D
(
ÁÁE F
x
ÁÁF G
.
ÁÁG H
IdActividad
ÁÁH S
.
ÁÁS T
Equals
ÁÁT Z
(
ÁÁZ [
primero
ÁÁ[ b
)
ÁÁb c
)
ÁÁc d
&&
ÁÁe g
(
ÁÁh i
x
ÁÁi j
.
ÁÁj k
TipoActividad
ÁÁk x
.
ÁÁx y
Equals
ÁÁy 
(ÁÁ Ä
identificadorÁÁÄ ç
)ÁÁç é
)ÁÁé è
)ÁÁè ê
.ÁÁê ë
FirstOrDefaultÁÁë ü
(ÁÁü †
)ÁÁ† °
;ÁÁ° ¢
activity
ËË 
[
ËË 
$num
ËË 
]
ËË 
=
ËË 
new
ËË 
Mapping
ËË 
(
ËË 
)
ËË 
.
ËË (
actividadEvaluacionInicial
ËË 9
.
ËË9 :
Where
ËË: ?
(
ËË? @
x
ËË@ A
=>
ËËB D
(
ËËE F
x
ËËF G
.
ËËG H
IdActividad
ËËH S
.
ËËS T
Equals
ËËT Z
(
ËËZ [
segundo
ËË[ b
)
ËËb c
)
ËËc d
&&
ËËe g
(
ËËh i
x
ËËi j
.
ËËj k
TipoActividad
ËËk x
.
ËËx y
Equals
ËËy 
(ËË Ä
identificadorËËÄ ç
)ËËç é
)ËËé è
)ËËè ê
.ËËê ë
FirstOrDefaultËËë ü
(ËËü †
)ËË† °
;ËË° ¢
activity
ÈÈ 
[
ÈÈ 
$num
ÈÈ 
]
ÈÈ 
=
ÈÈ 
new
ÈÈ 
Mapping
ÈÈ 
(
ÈÈ 
)
ÈÈ 
.
ÈÈ (
actividadEvaluacionInicial
ÈÈ 9
.
ÈÈ9 :
Where
ÈÈ: ?
(
ÈÈ? @
x
ÈÈ@ A
=>
ÈÈB D
(
ÈÈE F
x
ÈÈF G
.
ÈÈG H
IdActividad
ÈÈH S
.
ÈÈS T
Equals
ÈÈT Z
(
ÈÈZ [
tercero
ÈÈ[ b
)
ÈÈb c
)
ÈÈc d
&&
ÈÈe g
(
ÈÈh i
x
ÈÈi j
.
ÈÈj k
TipoActividad
ÈÈk x
.
ÈÈx y
Equals
ÈÈy 
(ÈÈ Ä
identificadorÈÈÄ ç
)ÈÈç é
)ÈÈé è
)ÈÈè ê
.ÈÈê ë
FirstOrDefaultÈÈë ü
(ÈÈü †
)ÈÈ† °
;ÈÈ° ¢
activityList
ÍÍ 
.
ÍÍ 
AddRange
ÍÍ 
(
ÍÍ 
activity
ÍÍ !
)
ÍÍ! "
;
ÍÍ" #
return
ÎÎ 	
activityList
ÎÎ
 
;
ÎÎ 
}
ÏÏ 
public
ÓÓ 
List
ÓÓ	 
<
ÓÓ 
PacienteScoreJSon
ÓÓ 
>
ÓÓ  #
GetPacienteScoreJSons
ÓÓ! 6
(
ÓÓ6 7
int
ÓÓ7 :
id_activity
ÓÓ; F
,
ÓÓF G
string
ÓÓH N
id_card_patient
ÓÓO ^
)
ÓÓ^ _
{
ÔÔ 

UActividad
 
activityDid
 
=
 
new
 
Mapping
  '
(
' (
)
( )
.
) *
	actividad
* 3
.
3 4
Where
4 9
(
9 :
x
: ;
=>
< >
x
? @
.
@ A
Id_actividad
A M
.
M N
Equals
N T
(
T U
id_activity
U `
)
` a
)
a b
.
b c
FirstOrDefault
c q
(
q r
)
r s
;
s t
List
ÒÒ 
<
ÒÒ 
PacienteScoreJSon
ÒÒ 
>
ÒÒ "
patientInTheActivity
ÒÒ /
=
ÒÒ0 1
new
ÒÒ2 5
List
ÒÒ6 :
<
ÒÒ: ;
PacienteScoreJSon
ÒÒ; L
>
ÒÒL M
(
ÒÒM N
)
ÒÒN O
;
ÒÒO P"
patientInTheActivity
ÚÚ 
=
ÚÚ 
JsonConvert
ÛÛ 
.
ÛÛ 
DeserializeObject
ÛÛ  
<
ÛÛ  !
List
ÛÛ! %
<
ÛÛ% &
PacienteScoreJSon
ÛÛ& 7
>
ÛÛ7 8
>
ÛÛ8 9
(
ÛÛ9 :
activityDid
ÛÛ: E
.
ÛÛE F*
EstudiantesHicieronActividad
ÛÛF b
)
ÛÛb c
;
ÛÛc d
return
ÙÙ 	"
patientInTheActivity
ÙÙ
 
.
ÙÙ 
Where
ÙÙ $
(
ÙÙ$ %
x
ÙÙ% &
=>
ÙÙ' )
x
ÙÙ* +
.
ÙÙ+ ,
DocumentoPaciente
ÙÙ, =
.
ÙÙ= >
Equals
ÙÙ> D
(
ÙÙD E
id_card_patient
ÙÙE T
)
ÙÙT U
)
ÙÙU V
.
ÙÙV W
ToList
ÙÙW ]
(
ÙÙ] ^
)
ÙÙ^ _
;
ÙÙ_ `
}
ıı 
public
˜˜ 
void
˜˜	 "
putInsertarresultado
˜˜ "
(
˜˜" #)
UResultadoEvaluacionInicial
˜˜# >

resultadoE
˜˜? I
)
˜˜I J
{
¯¯ 
using
˙˙ 
(
˙˙	 

var
˙˙
 
db
˙˙ 
=
˙˙ 
new
˙˙ 
Mapping
˙˙ 
(
˙˙ 
)
˙˙  
)
˙˙  !
{
˚˚ 
db
¸¸ 
.
¸¸ 1
#resultadoActividadEvaluacionInicial
¸¸ *
.
¸¸* +
Add
¸¸+ .
(
¸¸. /

resultadoE
¸¸/ 9
)
¸¸9 :
;
¸¸: ;
db
˝˝ 
.
˝˝ 
SaveChanges
˝˝ 
(
˝˝ 
)
˝˝ 
;
˝˝ 
}
˛˛ 
}
ˇˇ 
public
ÅÅ 
List
ÅÅ	 
<
ÅÅ &
UActividadPecsCategorias
ÅÅ &
>
ÅÅ& ')
getListaCategoriasAsignadas
ÅÅ( C
(
ÅÅC D
string
ÅÅD J

id_docente
ÅÅK U
,
ÅÅU V
string
ÅÅW ]
id_estudiante
ÅÅ^ k
)
ÅÅk l
{
ÇÇ 
List
ÉÉ 
<
ÉÉ &
UActividadPecsCategorias
ÉÉ  
>
ÉÉ  !%
listaCategriasAsignadas
ÉÉ" 9
=
ÉÉ: ;
new
ÉÉ< ?
List
ÉÉ@ D
<
ÉÉD E&
UActividadPecsCategorias
ÉÉE ]
>
ÉÉ] ^
(
ÉÉ^ _
)
ÉÉ_ `
;
ÉÉ` a%
listaCategriasAsignadas
ÖÖ 
=
ÖÖ 
new
ÖÖ  
Mapping
ÖÖ! (
(
ÖÖ( )
)
ÖÖ) *
.
ÖÖ* +&
uActividadPecsCategorias
ÖÖ+ C
.
ÖÖC D
Where
ÖÖD I
(
ÖÖI J
x
ÖÖJ K
=>
ÖÖL N
(
ÖÖO P
x
ÖÖP Q
.
ÖÖQ R

Id_docente
ÖÖR \
.
ÖÖ\ ]
Equals
ÖÖ] c
(
ÖÖc d

id_docente
ÖÖd n
)
ÖÖn o
)
ÖÖo p
&&
ÖÖq s
(
ÖÖt u
x
ÖÖu v
.
ÖÖv w
Id_estudianteÖÖw Ñ
.ÖÖÑ Ö
EqualsÖÖÖ ã
(ÖÖã å
id_estudianteÖÖå ô
)ÖÖô ö
)ÖÖö õ
&&ÖÖú û
(ÖÖü †
xÖÖ† °
.ÖÖ° ¢
	Estado_idÖÖ¢ ´
==ÖÖ´ ≠
$numÖÖ≠ Æ
)ÖÖÆ Ø
)ÖÖØ ∞
.ÖÖ∞ ±
ToListÖÖ± ∑
(ÖÖ∑ ∏
)ÖÖ∏ π
;ÖÖπ ∫
return
ÜÜ 	%
listaCategriasAsignadas
ÜÜ
 !
;
ÜÜ! "
}
áá 
public
ââ 
int
ââ	 ,
getCantidadCategoriasAsignadas
ââ +
(
ââ+ ,
string
ââ, 2

id_docente
ââ3 =
,
ââ= >
string
ââ? E
id_estudiante
ââF S
)
ââS T
{
ää 
int
ãã (
cantidadCategriasAsignadas
ãã !
;
ãã! "(
cantidadCategriasAsignadas
çç 
=
çç 
new
çç  #
Mapping
çç$ +
(
çç+ ,
)
çç, -
.
çç- .&
uActividadPecsCategorias
çç. F
.
ççF G
Where
ççG L
(
ççL M
x
ççM N
=>
ççO Q
(
ççR S
x
ççS T
.
ççT U

Id_docente
ççU _
.
çç_ `
Equals
çç` f
(
ççf g

id_docente
ççg q
)
ççq r
)
ççr s
&&
ççt v
(
ççw x
x
ççx y
.
ççy z
Id_estudianteççz á
.ççá à
Equalsççà é
(ççé è
id_estudianteççè ú
)ççú ù
)ççù û
)ççû ü
.ççü †
Countçç† •
(çç• ¶
)çç¶ ß
;ççß ®
return
éé 	(
cantidadCategriasAsignadas
éé
 $
+
éé$ %
$num
éé% &
;
éé& '
}
èè 
public
íí 
List
íí	 
<
íí &
UActividadPecsCategorias
íí &
>
íí& ' 
getListaCategorias
íí( :
(
íí: ;
string
íí; A

id_docente
ííB L
)
ííL M
{
ìì 
List
îî 
<
îî &
UActividadPecsCategorias
îî  
>
îî  !%
listaCategriasAsignadas
îî" 9
=
îî: ;
new
îî< ?
List
îî@ D
<
îîD E&
UActividadPecsCategorias
îîE ]
>
îî] ^
(
îî^ _
)
îî_ `
;
îî` a%
listaCategriasAsignadas
ññ 
=
ññ 
new
ññ  
Mapping
ññ! (
(
ññ( )
)
ññ) *
.
ññ* +&
uActividadPecsCategorias
ññ+ C
.
ññC D
Where
ññD I
(
ññI J
x
ññJ K
=>
ññL N
(
ññO P
x
ññP Q
.
ññQ R

Id_docente
ññR \
.
ññ\ ]
Equals
ññ] c
(
ññc d

id_docente
ññd n
)
ññn o
)
ñño p
)
ññp q
.
ññq r
ToList
ññr x
(
ññx y
)
ññy z
;
ññz {
return
óó 	%
listaCategriasAsignadas
óó
 !
;
óó! "
}
òò 
public
öö 
List
öö	 
<
öö 
UActividadPecs
öö 
>
öö '
getListaImagenesAsignadas
öö 7
(
öö7 8
string
öö8 >

id_docente
öö? I
,
ööI J
string
ööK Q
id_estudiante
ööR _
,
öö_ `
int
ööa d
categoria_id
ööe q
)
ööq r
{
õõ 
List
úú 
<
úú 
UActividadPecs
úú 
>
úú $
listaImagenesAsignadas
úú .
=
úú/ 0
new
úú1 4
List
úú5 9
<
úú9 :
UActividadPecs
úú: H
>
úúH I
(
úúI J
)
úúJ K
;
úúK L$
listaImagenesAsignadas
ûû 
=
ûû 
new
ûû 
Mapping
ûû  '
(
ûû' (
)
ûû( )
.
ûû) *
uActividadPecs
ûû* 8
.
ûû8 9
Where
ûû9 >
(
ûû> ?
x
ûû? @
=>
ûûA C
(
ûûD E
x
ûûE F
.
ûûF G

Id_docente
ûûG Q
.
ûûQ R
Equals
ûûR X
(
ûûX Y

id_docente
ûûY c
)
ûûc d
)
ûûd e
&&
ûûf h
(
ûûi j
x
ûûj k
.
ûûk l
Id_estudiante
ûûl y
.
ûûy z
Equalsûûz Ä
(ûûÄ Å
id_estudianteûûÅ é
)ûûé è
)ûûè ê
&&ûûë ì
(ûûî ï
xûûï ñ
.ûûñ ó
Categoria_idûûó £
==ûû§ ¶
categoria_idûûß ≥
)ûû≥ ¥
)ûû¥ µ
.ûûµ ∂
ToListûû∂ º
(ûûº Ω
)ûûΩ æ
;ûûæ ø
return
üü 	$
listaImagenesAsignadas
üü
  
;
üü  !
}
†† 
public
¢¢ 
void
¢¢	 "
putInsertarcategoria
¢¢ "
(
¢¢" #&
UActividadPecsCategorias
¢¢# ;

categoriaE
¢¢< F
)
¢¢F G
{
££ 
using
•• 
(
••	 

var
••
 
db
•• 
=
•• 
new
•• 
Mapping
•• 
(
•• 
)
••  
)
••  !
{
¶¶ 
db
ßß 
.
ßß &
uActividadPecsCategorias
ßß 
.
ßß  
Add
ßß  #
(
ßß# $

categoriaE
ßß$ .
)
ßß. /
;
ßß/ 0
db
®® 
.
®® 
SaveChanges
®® 
(
®® 
)
®® 
;
®® 
}
©© 
}
™™ 
public
¨¨ 
void
¨¨	 ,
putInsertaractividadImagenPECS
¨¨ ,
(
¨¨, -
UActividadPecs
¨¨- ;

actividadE
¨¨< F
)
¨¨F G
{
≠≠ 
using
ØØ 
(
ØØ	 

var
ØØ
 
db
ØØ 
=
ØØ 
new
ØØ 
Mapping
ØØ 
(
ØØ 
)
ØØ  
)
ØØ  !
{
∞∞ 
db
±± 
.
±± 
uActividadPecs
±± 
.
±± 
Add
±± 
(
±± 

actividadE
±± $
)
±±$ %
;
±±% &
db
≤≤ 
.
≤≤ 
SaveChanges
≤≤ 
(
≤≤ 
)
≤≤ 
;
≤≤ 
}
≥≥ 
}
¥¥ 
}
µµ 
}∂∂ ß
uC:\Users\asant\OneDrive\Escritorio\Andres Bernal\proyectos\proyectoTEAServicios\proyectoTEAServicios\Datos\Mapping.cs
public 
class 
Mapping 
: 
	DbContext  
{ 
public 
Mapping 
( 
) 
: 
base 
( 
$str (
)( )
{ 
}		 
public

 
DbSet

 
<

 
UUsers

 
>

 
user

 
{

 
get

  
;

  !
set

" %
;

% &
}

' (
public 
DbSet 
< 

UAcudiente 
> 
	acudiente #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
DbSet 
< 
UDocente 
> 
docente 
{  !
get" %
;% &
set' *
;* +
}, -
public 
DbSet 
< 
	UPaciente 
> 
paciente !
{" #
get$ '
;' (
set) ,
;, -
}. /
public 
DbSet 
< 
URol 
> 
rol 
{ 
get 
; 
set "
;" #
}$ %
public 
DbSet 
< 
UAcceso 
> 
acceso 
{ 
get  #
;# $
set% (
;( )
}* +
public 
DbSet 
< 

LoginToken 
> 
login_token %
{& '
get( +
;+ ,
set- 0
;0 1
}2 3
public 
DbSet 
< 
UTokenCompra 
> 
token_compra (
{) *
get+ .
;. /
set0 3
;3 4
}5 6
public 
DbSet 
< 

UActividad 
> 
	actividad #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
DbSet 
< 
UEvaluacionInicial  
>  !&
actividadEvaluacionInicial" <
{= >
get? B
;B C
setD G
;G H
}I J
public 
DbSet 
< 
UTipoActividad 
> 
uTipoActividads -
{. /
get0 3
;3 4
set5 8
;8 9
}: ;
public 
DbSet 
< 
UEstado_actividad 
>  
uEstado_Actividad! 2
{3 4
get5 8
;8 9
set: =
;= >
}? @
public 
DbSet 
< '
UResultadoEvaluacionInicial )
>) */
#resultadoActividadEvaluacionInicial+ N
{N O
getP S
;S T
setU X
;X Y
}Z [
public 
DbSet 
< $
UActividadPecsCategorias &
>& '$
uActividadPecsCategorias( @
{A B
getC F
;F G
setH K
;K L
}M N
public   
DbSet   
<   
UActividadPecs   
>   
uActividadPecs   ,
{  - .
get  / 2
;  2 3
set  4 7
;  7 8
}  9 :
public## 
DbSet## 
<## 
Utest## 
>## 
utest## 
{## 
get##  
;##  !
set##" %
;##% &
}##' (
}$$ ±
ÖC:\Users\asant\OneDrive\Escritorio\Andres Bernal\proyectos\proyectoTEAServicios\proyectoTEAServicios\Datos\Properties\AssemblyInfo.cs
[ 
assembly 	
:	 

AssemblyTitle 
( 
$str  
)  !
]! "
[		 
assembly		 	
:			 

AssemblyDescription		 
(		 
$str		 !
)		! "
]		" #
[

 
assembly

 	
:

	 
!
AssemblyConfiguration

  
(

  !
$str

! #
)

# $
]

$ %
[ 
assembly 	
:	 

AssemblyCompany 
( 
$str 
) 
] 
[ 
assembly 	
:	 

AssemblyProduct 
( 
$str "
)" #
]# $
[ 
assembly 	
:	 

AssemblyCopyright 
( 
$str 0
)0 1
]1 2
[ 
assembly 	
:	 

AssemblyTrademark 
( 
$str 
)  
]  !
[ 
assembly 	
:	 

AssemblyCulture 
( 
$str 
) 
] 
[ 
assembly 	
:	 


ComVisible 
( 
false 
) 
] 
[ 
assembly 	
:	 

Guid 
( 
$str 6
)6 7
]7 8
[## 
assembly## 	
:##	 

AssemblyVersion## 
(## 
$str## $
)##$ %
]##% &
[$$ 
assembly$$ 	
:$$	 

AssemblyFileVersion$$ 
($$ 
$str$$ (
)$$( )
]$$) *π$
wC:\Users\asant\OneDrive\Escritorio\Andres Bernal\proyectos\proyectoTEAServicios\proyectoTEAServicios\Datos\Seguridad.cs
	namespace		 	
Datos		
 
{

 
public 

class 
	Seguridad 
: 
Mapping $
{ 
public 

UsersLogin 

UsersLogin $
{ 	
get 
=> 
default 
( 

UsersLogin %
)% &
;& '
set 
{ 
} 
} 	
public 
async 
Task 
guardarTokenLogin +
(+ ,

LoginToken, 6
token7 <
)< =
{ 	
using 
( 
var 
db 
= 
new 
Mapping  '
(' (
)( )
)) *
{ 
db 
. 
login_token 
. 
Add "
(" #
token# (
)( )
;) *
db 
. 
SaveChanges 
( 
)  
;  !
} 
} 	
public 
async 
Task 
< 
UTokenCompra &
>& ''
buscarExistenciaTokenCompra( C
(C D
stringD J
cedulaEK R
)R S
{ 	
return   
new   
Mapping   
(   
)    
.    !
token_compra  ! -
.  - .
Where  . 3
(  3 4
x  4 5
=>  6 8
(  9 :
x  : ;
.  ; <
User_id  < C
.  C D
Equals  D J
(  J K
cedulaE  K R
)  R S
)  S T
)  T U
.  U V
FirstOrDefault  V d
(  d e
)  e f
;  f g
}!! 	
public## 
void## 
cerrarAcceso##  
(##  !
int##! $
userid##% +
)##+ ,
{$$ 	
using%% 
(%% 
var%% 
db%% 
=%% 
new%% 
Mapping%%  '
(%%' (
)%%( )
)%%) *
{&& 
UAcceso'' 
acceso'' 
=''  
new''! $
UAcceso''% ,
('', -
)''- .
;''. /
acceso(( 
=(( 
db(( 
.(( 
acceso(( "
.((" #
Where((# (
(((( )
x(() *
=>((+ -
x((. /
.((/ 0

Id_usuario((0 :
==((; =
userid((> D
&&((E G
x((H I
.((I J
Fecha_finSesion((J Y
==((Z \
null((] a
)((a b
.((b c
FirstOrDefault((c q
(((q r
)((r s
;((s t
acceso)) 
.)) 
Fecha_finSesion)) &
=))' (
DateTime))) 1
.))1 2
Now))2 5
;))5 6
db++ 
.++ 
acceso++ 
.++ 
Attach++  
(++  !
acceso++! '
)++' (
;++( )
var,, 
entry,, 
=,, 
db,, 
.,, 
Entry,, $
(,,$ %
acceso,,% +
),,+ ,
;,,, -
entry-- 
.-- 
State-- 
=-- 
EntityState-- )
.--) *
Modified--* 2
;--2 3
db.. 
... 
SaveChanges.. 
(.. 
)..  
;..  !
}// 
}00 	
public33 
void33 
borrarTokenLogin33 $
(33$ %
UUsers33% +
	idUsuario33, 5
)335 6
{44 	
using55 
(55 
var55 
db55 
=55 
new55 
Mapping55  '
(55' (
)55( )
)55) *
{66 

LoginToken77 
usuario77 "
=77# $
db77% '
.77' (
login_token77( 3
.773 4
Where774 9
(779 :
x77: ;
=>77< >
x77? @
.77@ A
User_id77A H
==77I K
	idUsuario77L U
.77U V
Id77V X
)77X Y
.77Y Z
First77Z _
(77_ `
)77` a
;77a b
db88 
.88 
login_token88 
.88 
Remove88 %
(88% &
usuario88& -
)88- .
;88. /
db99 
.99 
SaveChanges99 
(99 
)99  
;99  !
}:: 
};; 	
}== 
}>> ∆k
zC:\Users\asant\OneDrive\Escritorio\Andres Bernal\proyectos\proyectoTEAServicios\proyectoTEAServicios\Datos\UserPaciente.cs
	namespace 	
Datos
 
{ 
public		 

class		 
UserPaciente		 
:		 
Mapping		  '
{

 
public 
	UPaciente -
!verificarExistenciaDocenteEnlazar :
(: ;
UDocente; C
docenteAEnlazarD S
)S T
{ 	
return 
new 
Mapping 
( 
)  
.  !
paciente! )
.) *
Where* /
(/ 0
x0 1
=>2 4
(5 6
x6 7
.7 8
	Documento8 A
.A B
EqualsB H
(H I
docenteAEnlazarI X
.X Y%
Numero_documento_pacienteY r
)r s
)s t
)t u
.u v
FirstOrDefault	v Ñ
(
Ñ Ö
)
Ö Ü
;
Ü á
} 	
public 
bool 4
(verificarDocentePacienteMismaInstitucion <
(< =
UDocente= E
docenteAEnlazarF U
)U V
{ 	
	UPaciente 
paciente 
=  
new! $
Mapping% ,
(, -
)- .
.. /
paciente/ 7
.7 8
Where8 =
(= >
x> ?
=>@ B
(C D
xD E
.E F
	DocumentoF O
.O P
EqualsP V
(V W
docenteAEnlazarW f
.f g&
Numero_documento_paciente	g Ä
)
Ä Å
)
Å Ç
)
Ç É
.
É Ñ
FirstOrDefault
Ñ í
(
í ì
)
ì î
;
î ï
if 
( 
paciente 
. 
Institucion_id '
.' (
Equals( .
(. /
docenteAEnlazar/ >
.> ?
Institucion_id? M
)M N
)N O
{ 
return 
true 
; 
} 
else 
{ 
return 
false 
; 
} 
} 	
public 
void "
enlazarPacienteDocente *
(* +
UDocente+ 3
docenteAEnlazar4 C
)C D
{ 	
using   
(   
var   
db   
=   
new   
Mapping    '
(  ' (
)  ( )
)  ) *
{!! 
	UPaciente"" 
pacienteAEnlazar"" *
=""+ ,
db""- /
.""/ 0
paciente""0 8
.""8 9
Where""9 >
(""> ?
x""? @
=>""A C
(""D E
x""E F
.""F G
	Documento""G P
.""P Q
Equals""Q W
(""W X
docenteAEnlazar""X g
.""g h&
Numero_documento_paciente	""h Å
)
""Å Ç
)
""Ç É
)
""É Ñ
.
""Ñ Ö
FirstOrDefault
""Ö ì
(
""ì î
)
""î ï
;
""ï ñ
pacienteAEnlazar$$  
.$$  !
Documento_docente$$! 2
=$$3 4
docenteAEnlazar$$5 D
.$$D E
	Documento$$E N
;$$N O
var&& 
entry&& 
=&& 
db&& 
.&& 
Entry&& $
(&&$ %
pacienteAEnlazar&&% 5
)&&5 6
;&&6 7
entry'' 
.'' 
State'' 
='' 
EntityState'' )
.'') *
Modified''* 2
;''2 3
db(( 
.(( 
SaveChanges(( 
((( 
)((  
;((  !
}** 
},, 	
public.. 
List.. 
<.. 
	UPaciente.. 
>.. &
obtenerPacientesPorEnlazar.. 9
(..9 :
int..: =
id..> @
)..@ A
{// 	
using00 
(00 
var00 
db00 
=00 
new00 
Mapping00  '
(00' (
)00( )
)00) *
{11 
return22 
id22 
==22 
$num22 
?22  
db22! #
.22# $
paciente22$ ,
.22, -
Where22- 2
(222 3
x223 4
=>225 7
x228 9
.229 :
Documento_docente22: K
.22K L
Equals22L R
(22R S
null22S W
)22W X
)22X Y
.22Y Z
ToList22Z `
(22` a
)22a b
:22c d
db33 
.33 
paciente33 
.33  
Where33  %
(33% &
x33& '
=>33( *
x33+ ,
.33, -
Documento_acudiente33- @
.33@ A
Equals33A G
(33G H
null33H L
)33L M
)33M N
.33N O
ToList33O U
(33U V
)33V W
;33W X
}44 
}66 	
public77 
List77 
<77 
	UPaciente77 
>77 %
obtenerPacientesEnlazados77 8
(778 9
int779 <
id77= ?
,77? @
	UPaciente77A J
tipoUsuario77K V
)77V W
{88 	
using99 
(99 
var99 
db99 
=99 
new99 
Mapping99  '
(99' (
)99( )
)99) *
{:: 
return;; 
id;; 
==;; 
$num;; 
?;;  
db;;! #
.;;# $
paciente;;$ ,
.;;, -
Where;;- 2
(;;2 3
x;;3 4
=>;;5 7
x;;8 9
.;;9 :
Documento_docente;;: K
==;;L N
tipoUsuario;;O Z
.;;Z [
Documento_docente;;[ l
);;l m
.;;m n
ToList;;n t
(;;t u
);;u v
:;;w x
db<< 
.<< 
paciente<< 
.<<  
Where<<  %
(<<% &
x<<& '
=><<( *
x<<+ ,
.<<, -
Documento_acudiente<<- @
==<<A C
tipoUsuario<<D O
.<<O P
Documento_acudiente<<P c
)<<c d
.<<d e
ToList<<e k
(<<k l
)<<l m
;<<m n
}== 
}?? 	
public@@ 
void@@ '
enlazarDocenteConEstudiante@@ /
(@@/ 0
	UPaciente@@0 9
datos@@: ?
)@@? @
{AA 	
usingBB 
(BB 
varBB 
dbBB 
=BB 
newBB 
MappingBB  '
(BB' (
)BB( )
)BB) *
{CC 
	UPacienteDD 
pacienteAEnlazarDD *
=DD+ ,
dbDD- /
.DD/ 0
pacienteDD0 8
.DD8 9
WhereDD9 >
(DD> ?
xDD? @
=>DDA C
xDDD E
.DDE F
	DocumentoDDF O
.DDO P
EqualsDDP V
(DDV W
datosDDW \
.DD\ ]
	DocumentoDD] f
)DDf g
)DDg h
.DDh i
FirstOrDefaultDDi w
(DDw x
)DDx y
;DDy z
pacienteAEnlazarEE  
.EE  !
Documento_docenteEE! 2
=EE3 4
datosEE5 :
.EE: ;
Documento_docenteEE; L
;EEL M
varFF 
entryFF 
=FF 
dbFF 
.FF 
EntryFF $
(FF$ %
pacienteAEnlazarFF% 5
)FF5 6
;FF6 7
entryGG 
.GG 
StateGG 
=GG 
EntityStateGG )
.GG) *
ModifiedGG* 2
;GG2 3
dbHH 
.HH 
SaveChangesHH 
(HH 
)HH  
;HH  !
}JJ 
}KK 	
publicLL 
voidLL )
enlazarAcudienteConEstudianteLL 1
(LL1 2
	UPacienteLL2 ;
datosLL< A
)LLA B
{MM 	
usingNN 
(NN 
varNN 
dbNN 
=NN 
newNN 
MappingNN  '
(NN' (
)NN( )
)NN) *
{OO 
	UPacientePP 
pacienteAEnlazarPP *
=PP+ ,
dbPP- /
.PP/ 0
pacientePP0 8
.PP8 9
WherePP9 >
(PP> ?
xPP? @
=>PPA C
xPPD E
.PPE F
	DocumentoPPF O
.PPO P
EqualsPPP V
(PPV W
datosPPW \
.PP\ ]
	DocumentoPP] f
)PPf g
)PPg h
.PPh i
FirstOrDefaultPPi w
(PPw x
)PPx y
;PPy z
pacienteAEnlazarQQ  
.QQ  !
Documento_acudienteQQ! 4
=QQ5 6
datosQQ7 <
.QQ< =
Documento_acudienteQQ= P
;QQP Q
varRR 
entryRR 
=RR 
dbRR 
.RR 
EntryRR $
(RR$ %
pacienteAEnlazarRR% 5
)RR5 6
;RR6 7
entrySS 
.SS 
StateSS 
=SS 
EntityStateSS )
.SS) *
ModifiedSS* 2
;SS2 3
dbTT 
.TT 
SaveChangesTT 
(TT 
)TT  
;TT  !
}UU 
}VV 	
publicWW 
voidWW	 
eliminarEnlaceWW 
(WW 
	UPacienteWW &
datosWW' ,
)WW, -
{XX 
usingYY 
(YY	 

varYY
 
dbYY 
=YY 
newYY 
MappingYY 
(YY 
)YY  
)YY  !
{ZZ 
	UPaciente[[ 
pacienteADesenlazar[[ !
=[[" #
new[[$ '
	UPaciente[[( 1
([[1 2
)[[2 3
;[[3 4
if\\ 
(\\ 
datos\\ 
.\\ 
Documento_docente\\ 
!=\\  "
null\\# '
)\\' (
{]] 
pacienteADesenlazar^^ 
=^^ 
db^^ 
.^^ 
paciente^^ &
.^^& '
Where^^' ,
(^^, -
x^^- .
=>^^/ 1
(^^2 3
x^^3 4
.^^4 5
Documento_docente^^5 F
.^^F G
Equals^^G M
(^^M N
datos^^N S
.^^S T
Documento_docente^^T e
)^^e f
&&__ 
(__ 
x__ 	
.__	 

	Documento__
 
.__ 
Equals__ 
(__ 
datos__  
.__  !
	Documento__! *
)__* +
)__+ ,
)__, -
)__- .
.__. /
FirstOrDefault__/ =
(__= >
)__> ?
;__? @
pacienteADesenlazar`` 
.`` 
Documento_docente`` *
=``+ ,
null``- 1
;``1 2
}aa 
elsebb 
ifbb	 
(bb 
datosbb 
.bb 
Documento_acudientebb %
!=bb& (
nullbb) -
)bb- .
{cc 
pacienteADesenlazardd 
=dd 
dbdd 
.dd 
pacientedd &
.dd& '
Wheredd' ,
(dd, -
xdd- .
=>dd/ 1
(dd2 3
xdd3 4
.dd4 5
Documento_acudientedd5 H
.ddH I
EqualsddI O
(ddO P
datosddP U
.ddU V
Documento_acudienteddV i
)ddi j
&&ee 
(ee 	
xee	 

.ee
 
	Documentoee 
.ee 
Equalsee 
(ee 
datosee !
.ee! "
	Documentoee" +
)ee+ ,
)ee, -
)ee- .
)ee. /
.ee/ 0
FirstOrDefaultee0 >
(ee> ?
)ee? @
;ee@ A
pacienteADesenlazarff 
.ff 
Documento_acudienteff ,
=ff- .
nullff/ 3
;ff3 4
}gg 
varii 
entryii 
=ii 
dbii 
.ii 
Entryii 
(ii 
pacienteADesenlazarii ,
)ii, -
;ii- .
entryjj 	
.jj	 

Statejj
 
=jj 
EntityStatejj 
.jj 
Modifiedjj &
;jj& '
dbkk 
.kk 
SaveChangeskk 
(kk 
)kk 
;kk 
}ll 
}mm 
publicoo 
	UPacienteoo	 
datosPacienteoo  
(oo  !
stringoo! '
paciente_documentooo( :
)oo: ;
{pp 
usingqq 
(qq	 

varqq
 
dbqq 
=qq 
newqq 
Mappingqq 
(qq 
)qq  
)qq  !
{rr 
returnss 

dbss 
.ss 
pacientess 
.ss 
Wheress 
(ss 
xss 
=>ss !
xss" #
.ss# $
	Documentoss$ -
.ss- .
Equalsss. 4
(ss4 5
paciente_documentoss5 G
)ssG H
)ssH I
.ssI J
FirstOrDefaultssJ X
(ssX Y
)ssY Z
;ssZ [
}tt 
}uu 
publicww 
	UPacienteww	 !
getPatientInformationww (
(ww( )
Stringww) /
id_card_attendantww0 A
)wwA B
{xx 
returnyy 	
newyy
 
Mappingyy 
(yy 
)yy 
.yy 
pacienteyy  
.yy  !
Whereyy! &
(yy& '
xyy' (
=>yy) +
xyy, -
.yy- .
Documento_acudienteyy. A
.yyA B
EqualsyyB H
(yyH I
id_card_attendantyyI Z
)yyZ [
)yy[ \
.yy\ ]
FirstOrDefaultyy] k
(yyk l
)yyl m
;yym n
}zz 
}|| 
}}} –W
xC:\Users\asant\OneDrive\Escritorio\Andres Bernal\proyectos\proyectoTEAServicios\proyectoTEAServicios\Datos\UsersLogin.cs
	namespace		 	
Datos		
 
{

 
public 

class 

UsersLogin 
{ 
public 
UUsers &
verificarExistenciaUsuario 0
(0 1
UUsers1 7
usuarioE8 @
)@ A
{ 	
return 
new 
Mapping 
( 
)  
.  !
user! %
.% &
Where& +
(+ ,
x, -
=>. 0
(1 2
x2 3
.3 4
	Documento4 =
.= >
Equals> D
(D E
usuarioEE M
.M N
	DocumentoN W
)W X
)X Y
)Y Z
.Z [
FirstOrDefault[ i
(i j
)j k
;k l
} 	
public 
UUsers 
verificarLogin $
($ %
UUsers% +
usuarioE, 4
)4 5
{ 	
return 
new 
Mapping 
( 
)  
.  !
user! %
.% &
Where& +
(+ ,
x, -
=>. 0
(1 2
x2 3
.3 4
	Documento4 =
.= >
Equals> D
(D E
usuarioEE M
.M N
	DocumentoN W
)W X
)X Y
&&Z \
(] ^
x^ _
._ `
Clave` e
.e f
Equalsf l
(l m
usuarioEm u
.u v
Clavev {
){ |
)| }
)} ~
.~ 
FirstOrDefault	 ç
(
ç é
)
é è
;
è ê
} 	
public 
UUsers &
datosUsuarioSegunDocumento 0
(0 1
UUsers1 7
usuarioE8 @
)@ A
{ 	
UUsers 
usuario 
= 
new  
UUsers! '
(' (
)( )
;) *
usuario 
= 
new 
Mapping !
(! "
)" #
.# $
user$ (
.( )
Where) .
(. /
x/ 0
=>1 3
(4 5
x5 6
.6 7
	Documento7 @
.@ A
EqualsA G
(G H
usuarioEH P
.P Q
	DocumentoQ Z
)Z [
)[ \
)\ ]
.] ^
FirstOrDefault^ l
(l m
)m n
;n o
return 
usuario 
; 
} 	
public 
async 
Task 
< 

UAcudiente $
>$ %/
#datosAcudienteUsuarioSegunDocumento& I
(I J
stringJ P
cedulaEQ X
)X Y
{   	

UAcudiente!! 
	acudiente!!  
=!!! "
new!!# &

UAcudiente!!' 1
(!!1 2
)!!2 3
;!!3 4
	acudiente"" 
="" 
new"" 
Mapping"" #
(""# $
)""$ %
.""% &
	acudiente""& /
.""/ 0
Where""0 5
(""5 6
x""6 7
=>""8 :
x""; <
.""< =
	Documento""= F
.""F G
Equals""G M
(""M N
cedulaE""N U
)""U V
)""V W
.""W X
FirstOrDefault""X f
(""f g
)""g h
;""h i
return## 
	acudiente## 
;## 
}$$ 	
public&& 
async&& 
Task&& 
<&& 
	UPaciente&& #
>&&# $'
datosPacienteSegunDocumento&&% @
(&&@ A
string&&A G
cedulaE&&H O
)&&O P
{'' 	
	UPaciente(( 
usuario(( 
=(( 
new((  #
	UPaciente(($ -
(((- .
)((. /
;((/ 0
usuario)) 
=)) 
new)) 
Mapping)) !
())! "
)))" #
.))# $
paciente))$ ,
.)), -
Where))- 2
())2 3
x))3 4
=>))5 7
())8 9
x))9 :
.)): ;
	Documento)); D
.))D E
Equals))E K
())K L
cedulaE))L S
)))S T
)))T U
)))U V
.))V W
FirstOrDefault))W e
())e f
)))f g
;))g h
return** 
usuario** 
;** 
}++ 	
public-- 
async-- 
Task-- 
<-- 
UDocente-- "
>--" #-
!datosDocenteUsuarioSegunDocumento--$ E
(--E F
string--F L
cedulaE--M T
)--T U
{.. 	
UDocente// 
usuario// 
=// 
new// "
UDocente//# +
(//+ ,
)//, -
;//- .
usuario00 
=00 
new00 
Mapping00 !
(00! "
)00" #
.00# $
docente00$ +
.00+ ,
Where00, 1
(001 2
x002 3
=>004 6
(007 8
x008 9
.009 :
	Documento00: C
.00C D
Equals00D J
(00J K
cedulaE00K R
)00R S
)00S T
)00T U
.00U V
FirstOrDefault00V d
(00d e
)00e f
;00f g
return11 
usuario11 
;11 
}22 	
public44 
void44 
agregarAcceso44 !
(44! "
UAcceso44" )
accesoUsuarioE44* 8
)448 9
{55 	
using66 
(66 
var66 
db66 
=66 
new66 
Mapping66  '
(66' (
)66( )
)66) *
{66+ ,
db77 
.77 
acceso77 
.77 
Add77 
(77 
accesoUsuarioE77 ,
)77, -
;77- .
db88 
.88 
SaveChanges88 
(88 
)88  
;88  !
}99 
}:: 	
public<< 
UUsers<<	 
confirmarCorreo<< 
(<<  
string<<  &
correo<<' -
)<<- .
{== 
using>> 
(>> 	
var>>	 
db>> 
=>> 
new>> 
Mapping>> 
(>> 
)>> 
)>>  
{?? 
UDocente@@ 
docenteCorreo@@ 
=@@ 
db@@ 
.@@  
docente@@  '
.@@' (
Where@@( -
(@@- .
x@@. /
=>@@0 2
x@@3 4
.@@4 5
Correo@@5 ;
.@@; <
Equals@@< B
(@@B C
correo@@C I
)@@I J
)@@J K
.@@K L
FirstOrDefault@@L Z
(@@Z [
)@@[ \
;@@\ ]

UAcudienteAA 
acudienteCorreoAA 
=AA  
dbAA! #
.AA# $
	acudienteAA$ -
.AA- .
WhereAA. 3
(AA3 4
xAA4 5
=>AA6 8
xAA9 :
.AA: ;
CorreoAA; A
.AAA B
EqualsAAB H
(AAH I
correoAAI O
)AAO P
)AAP Q
.AAQ R
FirstOrDefaultAAR `
(AA` a
)AAa b
;AAb c
ifBB 
(BB 
docenteCorreoBB 
!=BB 
nullBB 
)BB 
{CC 
varDD 
respuDD	 
=DD 
dbDD 
.DD 
userDD 
.DD 
WhereDD 
(DD 
xDD  
=>DD! #
xDD$ %
.DD% &
	DocumentoDD& /
.DD/ 0
EqualsDD0 6
(DD6 7
docenteCorreoDD7 D
.DDD E
	DocumentoDDE N
)DDN O
)DDO P
.DDP Q
FirstOrDefaultDDQ _
(DD_ `
)DD` a
;DDa b
returnEE 
respuEE 
;EE 
}FF 
elseGG 
ifGG	 
(GG 
acudienteCorreoGG 
!=GG 
nullGG  $
)GG$ %
{HH 
returnII 
dbII 
.II 
userII 
.II 
WhereII 
(II 
xII 
=>II 
xII  
.II  !
	DocumentoII! *
.II* +
EqualsII+ 1
(II1 2
acudienteCorreoII2 A
.IIA B
	DocumentoIIB K
)IIK L
)IIL M
.IIM N
FirstOrDefaultIIN \
(II\ ]
)II] ^
;II^ _
}JJ 
returnKK 

nullKK 
;KK 
}LL 
}MM 
publicNN 
voidNN	 %
cambiarDatosParaRecuperarNN '
(NN' (
UUsersNN( .
borrarClaveNN/ :
)NN: ;
{OO 
usingPP 
(PP	 

varPP
 
dbPP 
=PP 
newPP 
MappingPP 
(PP 
)PP  
)PP  !
{QQ 
UUsersRR 

usersRR 
=RR 
dbRR 
.RR 
userRR 
.RR 
WhereRR  
(RR  !
xRR! "
=>RR# %
xRR& '
.RR' (
	DocumentoRR( 1
.RR1 2
EqualsRR2 8
(RR8 9
borrarClaveRR9 D
.RRD E
	DocumentoRRE N
)RRN O
)RRO P
.RRP Q
FirstRRQ V
(RRV W
)RRW X
;RRX Y
usersTT 	
.TT	 

ClaveTT
 
=TT 
borrarClaveTT 
.TT 
ClaveTT #
;TT# $
usersUU 	
.UU	 

TokenUU
 
=UU 
borrarClaveUU 
.UU 
TokenUU #
;UU# $
usersVV 	
.VV	 

Token_expirarVV
 
=VV 
borrarClaveVV %
.VV% &
Token_expirarVV& 3
;VV3 4
varXX 
entyXX 
=XX 
dbXX 
.XX 
EntryXX 
(XX 
usersXX 
)XX 
;XX 
entyYY 
.YY 	
StateYY	 
=YY 
EntityStateYY 
.YY 
ModifiedYY %
;YY% &
dbZZ 
.ZZ 
SaveChangesZZ 
(ZZ 
)ZZ 
;ZZ 
}[[ 
}\\ 
public]] 
UUsers]]	  
accesoRecuperarClave]] $
(]]$ %
string]]% +
token]], 1
)]]1 2
{^^ 
using__ 
(__	 

var__
 
db__ 
=__ 
new__ 
Mapping__ 
(__ 
)__  
)__  !
{`` 
returnaa 

dbaa 
.aa 
useraa 
.aa 
Whereaa 
(aa 
xaa 
=>aa 
xaa 
.aa  
Tokenaa  %
.aa% &
Equalsaa& ,
(aa, -
tokenaa- 2
)aa2 3
)aa3 4
.aa4 5
FirstOrDefaultaa5 C
(aaC D
)aaD E
;aaE F
}bb 
}cc 
}dd 
}ee ‘¿
{C:\Users\asant\OneDrive\Escritorio\Andres Bernal\proyectos\proyectoTEAServicios\proyectoTEAServicios\Datos\UsersRegister.cs
	namespace 	
Datos
 
{ 
public 
class 
UsersRegister 
{		 
public

 

UsersLogin

	 

UsersLogin

 
{ 
get 
=> 	
default
 
( 

UsersLogin 
) 
; 
set 
{ 
} 
} 
public 
void	 
agregarUsuario 
( 
UUsers #
nuevoUsuario$ 0
)0 1
{ 
using 
(	 

var
 
db 
= 
new 
Mapping 
( 
)  
)  !
{ 
db 
. 
user 
. 
Add 
( 
nuevoUsuario 
) 
; 
db 
. 
SaveChanges 
( 
) 
; 
} 
} 
public 
UUsers	 &
AcudienteODocenteExistente *
(* +
string+ 1
cedula2 8
,8 9
int: =
rol> A
)A B
{ 
return 	
new
 
Mapping 
( 
) 
. 
user 
. 
Where "
(" #
x# $
=>% '
(( )
x) *
.* +
	Documento+ 4
.4 5
Equals5 ;
(; <
cedula< B
)B C
&&D F
xG H
.H I
Rol_idI O
.O P
EqualsP V
(V W
rolW Z
)Z [
)[ \
)\ ]
.] ^
FirstOrDefault^ l
(l m
)m n
;n o
} 
public"" 
UUsers""	 4
(verificarExistenciaDeCedulaRespectoIdRol"" 8
(""8 9
UUsers""9 ?
nuevoUsuario""@ L
)""L M
{## 
return$$ 	
new$$
 
Mapping$$ 
($$ 
)$$ 
.$$ 
user$$ 
.$$ 
Where$$ "
($$" #
x$$# $
=>$$% '
($$( )
x$$) *
.$$* +
	Documento$$+ 4
.$$4 5
Equals$$5 ;
($$; <
nuevoUsuario$$< H
.$$H I
	Documento$$I R
)$$R S
)$$S T
)$$T U
.$$U V
FirstOrDefault$$V d
($$d e
)$$e f
;$$f g
}%% 
public'' 
UUsers''	 0
$verificarExistenciaDocumentoPaciente'' 4
(''4 5
UUsers''5 ;
nuevoPaciente''< I
)''I J
{(( 
return)) 	
new))
 
Mapping)) 
()) 
))) 
.)) 
user)) 
.)) 
Where)) "
())" #
x))# $
=>))% '
())( )
x))) *
.))* +
	Documento))+ 4
.))4 5
Equals))5 ;
()); <
nuevoPaciente))< I
.))I J
	Documento))J S
)))S T
)))T U
)))U V
.))V W
FirstOrDefault))W e
())e f
)))f g
;))g h
}** 
public,, 
void,,	 
agregarAcudiente,, 
(,, 

UAcudiente,, )
nuevoAcudiente,,* 8
),,8 9
{-- 
using.. 
(..	 

var..
 
db.. 
=.. 
new.. 
Mapping.. 
(.. 
)..  
)..  !
{// 
db00 
.00 
	acudiente00 
.00 
Add00 
(00 
nuevoAcudiente00 #
)00# $
;00$ %
db11 
.11 
SaveChanges11 
(11 
)11 
;11 
}22 
}33 
public44 
void44	 
agregarDocente44 
(44 
UDocente44 %
nuevoDocente44& 2
)442 3
{55 
using66 
(66	 

var66
 
db66 
=66 
new66 
Mapping66 
(66 
)66  
)66  !
{77 
db88 
.88 
docente88 
.88 
Add88 
(88 
nuevoDocente88 
)88  
;88  !
db99 
.99 
SaveChanges99 
(99 
)99 
;99 
}:: 
};; 
public== 
void==	 
agregarPaciente== 
(== 
	UPaciente== '
nuevoPaciente==( 5
)==5 6
{>> 
using?? 
(??	 

var??
 
db?? 
=?? 
new?? 
Mapping?? 
(?? 
)??  
)??  !
{@@ 
dbAA 
.AA 
pacienteAA 
.AA 
AddAA 
(AA 
nuevoPacienteAA !
)AA! "
;AA" #
dbBB 
.BB 
SaveChangesBB 
(BB 
)BB 
;BB 
}CC 
}DD 
publicFF 
boolFF	 %
revisarExistenciaDeCorreoFF '
(FF' (
stringFF( .
correoFF/ 5
)FF5 6
{GG 
boolHH 
existeHH 
=HH 
falseHH 
;HH 
usingII 
(II	 

varII
 
dbII 
=II 
newII 
MappingII 
(II 
)II  
)II  !
{JJ 
ifKK 
(KK 
(KK 	
dbKK	 
.KK 
docenteKK 
.KK 
WhereKK 
(KK 
xKK 
=>KK 
(KK  
xKK  !
.KK! "
CorreoKK" (
.KK( )
EqualsKK) /
(KK/ 0
correoKK0 6
)KK6 7
)KK7 8
)KK8 9
)KK9 :
.KK: ;
FirstOrDefaultKK; I
(KKI J
)KKJ K
!=KKL N
nullKKO S
)KKS T
{LL 
existeMM 
=MM 
trueMM 
;MM 
returnNN 
existeNN 
;NN 
}OO 
elsePP 
ifPP	 
(PP 
(PP 
dbPP 
.PP 
	acudientePP 
.PP 
WherePP  
(PP  !
xPP! "
=>PP# %
(PP& '
xPP' (
.PP( )
CorreoPP) /
.PP/ 0
EqualsPP0 6
(PP6 7
correoPP7 =
)PP= >
)PP> ?
)PP? @
)PP@ A
.PPA B
FirstOrDefaultPPB P
(PPP Q
)PPQ R
!=PPS U
nullPPV Z
)PPZ [
{QQ 
existeRR 
=RR 
trueRR 
;RR 
returnSS 
existeSS 
;SS 
}TT 
elseUU 
{VV 
returnWW 
existeWW 
;WW 
}XX 
}ZZ 
}[[ 
public__ 
string__	  
putActualizarDocente__ $
(__$ %
UDocente__% -
docenteNuevo__. :
,__: ;
int__< ?
tipoDeAcualizacion__@ R
)__R S
{`` 
usingaa 
(aa	 

varaa
 
dbaa 
=aa 
newaa 
Mappingaa 
(aa 
)aa  
)aa  !
{bb 
stringcc 

	respuestacc 
=cc 
$strcc 9
;cc9 :
UDocentedd 
docenteActualizardd 
=dd  
dbdd! #
.dd# $
docentedd$ +
.dd+ ,
Wheredd, 1
(dd1 2
xdd2 3
=>dd4 6
xdd7 8
.dd8 9
	Documentodd9 B
.ddB C
EqualsddC I
(ddI J
docenteNuevoddJ V
.ddV W
	DocumentoddW `
)dd` a
)dda b
.ddb c
FirstOrDefaultddc q
(ddq r
)ddr s
;dds t
UUsersee 

docenteActualee 
=ee 
dbee 
.ee 
useree "
.ee" #
Whereee# (
(ee( )
xee) *
=>ee+ -
xee. /
.ee/ 0
	Documentoee0 9
.ee9 :
Equalsee: @
(ee@ A
docenteNuevoeeA M
.eeM N
	DocumentoeeN W
)eeW X
&&eeY [
xee\ ]
.ee] ^
Claveee^ c
.eec d
Equalseed j
(eej k
docenteNuevoeek w
.eew x
Clave_actual	eex Ñ
)
eeÑ Ö
)
eeÖ Ü
.
eeÜ á
FirstOrDefault
eeá ï
(
eeï ñ
)
eeñ ó
;
eeó ò
switchff 

(ff 
tipoDeAcualizacionff 
)ff 
{gg 
caseii 	
$numii
 
:ii 
docenteActualizarjj 
.jj 
Nombrejj 
=jj  
docenteNuevojj! -
.jj- .
Nombrejj. 4
;jj4 5
docenteActualizarkk 
.kk 
Apellidokk  
=kk! "
docenteNuevokk# /
.kk/ 0
Apellidokk0 8
;kk8 9
breakll 
;ll 
casenn 	
$numnn
 
:nn 
ifoo 
(oo	 

docenteActualoo
 
!=oo 
nulloo 
)oo  
{pp 
docenteActualqq 
.qq 
Claveqq 
=qq 
docenteNuevoqq )
.qq) *
Claveqq* /
;qq/ 0
varrr 

entyCrr 
=rr 
dbrr 
.rr 
Entryrr 
(rr 
docenteActualrr )
)rr) *
;rr* +
entyCss 
.ss 
Statess 
=ss 
EntityStatess  
.ss  !
Modifiedss! )
;ss) *
dbtt 	
.tt	 

SaveChangestt
 
(tt 
)tt 
;tt 
returnuu 
	respuestauu 
;uu 
}vv 
elseww 

{xx 
returnyy 
$stryy ,
;yy, -
}zz 
case|| 	
$num||
 
:|| 
docenteActualizar}} 
.}} 
Correo}} 
=}}  
docenteNuevo}}! -
.}}- .
Correo}}. 4
;}}4 5
break~~ 
;~~ 
} 
var
ÅÅ 
enty
ÅÅ 
=
ÅÅ 
db
ÅÅ 
.
ÅÅ 
Entry
ÅÅ 
(
ÅÅ 
docenteActualizar
ÅÅ )
)
ÅÅ) *
;
ÅÅ* +
enty
ÇÇ 
.
ÇÇ 	
State
ÇÇ	 
=
ÇÇ 
EntityState
ÇÇ 
.
ÇÇ 
Modified
ÇÇ %
;
ÇÇ% &
db
ÉÉ 
.
ÉÉ 
SaveChanges
ÉÉ 
(
ÉÉ 
)
ÉÉ 
;
ÉÉ 
return
ÑÑ 

	respuesta
ÑÑ 
;
ÑÑ 
}
ÖÖ 
}
áá 
public
ââ 
string
ââ	 $
putActualizarAcudiente
ââ &
(
ââ& '

UAcudiente
ââ' 1
acudienteNuevo
ââ2 @
,
ââ@ A
int
ââB E 
tipoDeAcualizacion
ââF X
)
ââX Y
{
ää 
using
ãã 
(
ãã	 

var
ãã
 
db
ãã 
=
ãã 
new
ãã 
Mapping
ãã 
(
ãã 
)
ãã  
)
ãã  !
{
åå 
string
çç 

	respuesta
çç 
=
çç 
$str
çç ;
;
çç; <

UAcudiente
éé !
acudienteActualizar
éé "
=
éé# $
db
éé% '
.
éé' (
	acudiente
éé( 1
.
éé1 2
Where
éé2 7
(
éé7 8
x
éé8 9
=>
éé: <
x
éé= >
.
éé> ?
	Documento
éé? H
.
ééH I
Equals
ééI O
(
ééO P
acudienteNuevo
ééP ^
.
éé^ _
	Documento
éé_ h
)
ééh i
)
ééi j
.
ééj k
FirstOrDefault
éék y
(
ééy z
)
ééz {
;
éé{ |
UUsers
èè 

acudienteActual
èè 
=
èè 
db
èè 
.
èè  
user
èè  $
.
èè$ %
Where
èè% *
(
èè* +
x
èè+ ,
=>
èè- /
x
èè0 1
.
èè1 2
	Documento
èè2 ;
.
èè; <
Equals
èè< B
(
èèB C
acudienteNuevo
èèC Q
.
èèQ R
	Documento
èèR [
)
èè[ \
&&
èè] _
x
èè` a
.
èèa b
Clave
èèb g
.
èèg h
Equals
èèh n
(
èèn o
acudienteNuevo
èèo }
.
èè} ~
Clave_actualèè~ ä
)èèä ã
)èèã å
.èèå ç
FirstOrDefaultèèç õ
(èèõ ú
)èèú ù
;èèù û
switch
êê 

(
êê  
tipoDeAcualizacion
êê 
)
êê 
{
ëë 
case
ìì 	
$num
ìì
 
:
ìì !
acudienteActualizar
îî 
.
îî 
Nombre
îî  
=
îî! "
acudienteNuevo
îî# 1
.
îî1 2
Nombre
îî2 8
;
îî8 9!
acudienteActualizar
ïï 
.
ïï 
Apellido
ïï "
=
ïï# $
acudienteNuevo
ïï% 3
.
ïï3 4
Apellido
ïï4 <
;
ïï< =
break
ññ 
;
ññ 
case
òò 	
$num
òò
 
:
òò 
if
ôô 
(
ôô	 

acudienteActual
ôô
 
!=
ôô 
null
ôô !
)
ôô! "
{
öö 
acudienteActual
õõ 
.
õõ 
Clave
õõ 
=
õõ 
acudienteNuevo
õõ -
.
õõ- .
Clave
õõ. 3
;
õõ3 4
var
úú 

entyC
úú 
=
úú 
db
úú 
.
úú 
Entry
úú 
(
úú 
acudienteActual
úú +
)
úú+ ,
;
úú, -
entyC
ùù 
.
ùù 
State
ùù 
=
ùù 
EntityState
ùù  
.
ùù  !
Modified
ùù! )
;
ùù) *
db
ûû 	
.
ûû	 

SaveChanges
ûû
 
(
ûû 
)
ûû 
;
ûû 
return
üü 
	respuesta
üü 
;
üü 
}
†† 
else
°° 

{
¢¢ 
return
££ 
$str
££ ,
;
££, -
}
§§ 
case
¶¶ 	
$num
¶¶
 
:
¶¶ !
acudienteActualizar
ßß 
.
ßß 
Correo
ßß  
=
ßß! "
acudienteNuevo
ßß# 1
.
ßß1 2
Correo
ßß2 8
;
ßß8 9
break
®® 
;
®® 
}
©© 
var
´´ 
enty
´´ 
=
´´ 
db
´´ 
.
´´ 
Entry
´´ 
(
´´ !
acudienteActualizar
´´ +
)
´´+ ,
;
´´, -
enty
¨¨ 
.
¨¨ 	
State
¨¨	 
=
¨¨ 
EntityState
¨¨ 
.
¨¨ 
Modified
¨¨ %
;
¨¨% &
db
≠≠ 
.
≠≠ 
SaveChanges
≠≠ 
(
≠≠ 
)
≠≠ 
;
≠≠ 
return
ÆÆ 

	respuesta
ÆÆ 
;
ÆÆ 
}
ØØ 
}
±± 
public
≥≥ 
string
≥≥	 #
putActualizarPaciente
≥≥ %
(
≥≥% &
	UPaciente
≥≥& /
pacienteNuevo
≥≥0 =
,
≥≥= >
int
≥≥? B 
tipoDeAcualizacion
≥≥C U
)
≥≥U V
{
¥¥ 
using
µµ 
(
µµ	 

var
µµ
 
db
µµ 
=
µµ 
new
µµ 
Mapping
µµ 
(
µµ 
)
µµ  
)
µµ  !
{
∂∂ 
string
∑∑ 

	respuesta
∑∑ 
=
∑∑ 
$str
∑∑ :
;
∑∑: ;
	UPaciente
∏∏  
pacienteActualizar
∏∏  
=
∏∏! "
db
∏∏# %
.
∏∏% &
paciente
∏∏& .
.
∏∏. /
Where
∏∏/ 4
(
∏∏4 5
x
∏∏5 6
=>
∏∏7 9
x
∏∏: ;
.
∏∏; <
	Documento
∏∏< E
.
∏∏E F
Equals
∏∏F L
(
∏∏L M
pacienteNuevo
∏∏M Z
.
∏∏Z [
	Documento
∏∏[ d
)
∏∏d e
)
∏∏e f
.
∏∏f g
FirstOrDefault
∏∏g u
(
∏∏u v
)
∏∏v w
;
∏∏w x
UUsers
ππ 

pacienteActual
ππ 
=
ππ 
db
ππ 
.
ππ 
user
ππ #
.
ππ# $
Where
ππ$ )
(
ππ) *
x
ππ* +
=>
ππ, .
x
ππ/ 0
.
ππ0 1
	Documento
ππ1 :
.
ππ: ;
Equals
ππ; A
(
ππA B
pacienteNuevo
ππB O
.
ππO P
	Documento
ππP Y
)
ππY Z
&&
ππ[ ]
x
ππ^ _
.
ππ_ `
Clave
ππ` e
.
ππe f
Equals
ππf l
(
ππl m
pacienteNuevo
ππm z
.
ππz {
Clave_actualππ{ á
)ππá à
)ππà â
.ππâ ä
FirstOrDefaultππä ò
(ππò ô
)ππô ö
;ππö õ
switch
∫∫ 

(
∫∫  
tipoDeAcualizacion
∫∫ 
)
∫∫ 
{
ªª 
case
ΩΩ 	
$num
ΩΩ
 
:
ΩΩ  
pacienteActualizar
ææ 
.
ææ 
Nombre
ææ 
=
ææ  !
pacienteNuevo
ææ" /
.
ææ/ 0
Nombre
ææ0 6
;
ææ6 7 
pacienteActualizar
øø 
.
øø 
Apellido
øø !
=
øø" #
pacienteNuevo
øø$ 1
.
øø1 2
Apellido
øø2 :
;
øø: ;
break
¿¿ 
;
¿¿ 
case
¬¬ 	
$num
¬¬
 
:
¬¬ 
if
√√ 
(
√√	 

pacienteActual
√√
 
!=
√√ 
null
√√  
)
√√  !
{
ƒƒ 
pacienteActual
≈≈ 
.
≈≈ 
Clave
≈≈ 
=
≈≈ 
pacienteNuevo
≈≈ +
.
≈≈+ ,
Clave
≈≈, 1
;
≈≈1 2
var
∆∆ 

entyC
∆∆ 
=
∆∆ 
db
∆∆ 
.
∆∆ 
Entry
∆∆ 
(
∆∆ 
pacienteActual
∆∆ *
)
∆∆* +
;
∆∆+ ,
entyC
«« 
.
«« 
State
«« 
=
«« 
EntityState
««  
.
««  !
Modified
««! )
;
««) *
db
»» 	
.
»»	 

SaveChanges
»»
 
(
»» 
)
»» 
;
»» 
return
…… 
	respuesta
…… 
;
…… 
}
   
else
ÀÀ 

{
ÃÃ 
return
ÕÕ 
$str
ÕÕ ,
;
ÕÕ, -
}
ŒŒ 
case
–– 	
$num
––
 
:
––  
pacienteActualizar
—— 
.
—— 
Grado_autismo
—— &
=
——' (
pacienteNuevo
——) 6
.
——6 7
Grado_autismo
——7 D
;
——D E 
pacienteActualizar
““ 
.
““ 
Edad
““ 
=
““ 
pacienteNuevo
““  -
.
““- .
Edad
““. 2
;
““2 3
break
”” 
;
”” 
}
‘‘ 
var
÷÷ 
enty
÷÷ 
=
÷÷ 
db
÷÷ 
.
÷÷ 
Entry
÷÷ 
(
÷÷  
pacienteActualizar
÷÷ *
)
÷÷* +
;
÷÷+ ,
enty
◊◊ 
.
◊◊ 	
State
◊◊	 
=
◊◊ 
EntityState
◊◊ 
.
◊◊ 
Modified
◊◊ %
;
◊◊% &
db
ÿÿ 
.
ÿÿ 
SaveChanges
ÿÿ 
(
ÿÿ 
)
ÿÿ 
;
ÿÿ 
return
ŸŸ 

	respuesta
ŸŸ 
;
ŸŸ 
}
⁄⁄ 
}
‹‹ 
public
ﬂﬂ 
Boolean
ﬂﬂ	  
agregarTokenCompra
ﬂﬂ #
(
ﬂﬂ# $
UDocente
ﬂﬂ$ , 
datosDocenteCompra
ﬂﬂ- ?
,
ﬂﬂ? @
string
ﬂﬂA G
token
ﬂﬂH M
)
ﬂﬂM N
{
‡‡ 
using
·· 
(
··	 

var
··
 
db
·· 
=
·· 
new
·· 
Mapping
·· 
(
·· 
)
··  
)
··  !
{
‚‚ 
bool
ÂÂ 
mensaje
ÂÂ	 
=
ÂÂ 
false
ÂÂ 
;
ÂÂ 
int
ÁÁ 
	tokeExist
ÁÁ 
=
ÁÁ 
db
ÁÁ 
.
ÁÁ 
token_compra
ÁÁ #
.
ÁÁ# $
Where
ÁÁ$ )
(
ÁÁ) *
x
ÁÁ* +
=>
ÁÁ, .
(
ÁÁ/ 0
x
ÁÁ0 1
.
ÁÁ1 2
User_id
ÁÁ2 9
.
ÁÁ9 :
Equals
ÁÁ: @
(
ÁÁ@ A 
datosDocenteCompra
ÁÁA S
.
ÁÁS T
	Documento
ÁÁT ]
)
ÁÁ] ^
)
ÁÁ^ _
&&
ÁÁ` b
(
ÁÁc d
x
ÁÁd e
.
ÁÁe f
Fecha_vigencia
ÁÁf t
>
ÁÁu v
DateTime
ÁÁw 
.ÁÁ Ä
NowÁÁÄ É
)ÁÁÑ Ö
&&ÁÁÜ à
(ÁÁâ ä
xÁÁä ã
.ÁÁã å
TokenÁÁå ë
!=ÁÁí î
nullÁÁï ô
)ÁÁô ö
)ÁÁö õ
.ÁÁõ ú
CountÁÁú °
(ÁÁ° ¢
)ÁÁ¢ £
;ÁÁ£ §
if
ÈÈ 
(
ÈÈ 
	tokeExist
ÈÈ 
>=
ÈÈ  
$num
ÈÈ! "
)
ÈÈ" #
{
ÍÍ 
mensaje
ÏÏ 
=
ÏÏ 
false
ÏÏ 
;
ÏÏ 
}
ÌÌ 
else
ÓÓ 
if
ÓÓ 
(
ÓÓ 
	tokeExist
ÓÓ !
==
ÓÓ" $
$num
ÓÓ% &
)
ÓÓ& '
{
ÔÔ 
UTokenCompra
 
compraDatos
 
=
 
new
  #
UTokenCompra
$ 0
(
0 1
)
1 2
;
2 3
compraDatos
ÒÒ 
.
ÒÒ 
User_id
ÒÒ 
=
ÒÒ  
datosDocenteCompra
ÒÒ -
.
ÒÒ- .
	Documento
ÒÒ. 7
;
ÒÒ7 8
compraDatos
ÚÚ 
.
ÚÚ 
Fecha_generado
ÚÚ 
=
ÚÚ  !
DateTime
ÚÚ" *
.
ÚÚ* +
Now
ÚÚ+ .
;
ÚÚ. /
compraDatos
ÛÛ 
.
ÛÛ 
Fecha_vigencia
ÛÛ 
=
ÛÛ  !
DateTime
ÛÛ" *
.
ÛÛ* +
Now
ÛÛ+ .
.
ÛÛ. /
AddDays
ÛÛ/ 6
(
ÛÛ6 7
$num
ÛÛ7 :
)
ÛÛ: ;
;
ÛÛ; <
compraDatos
ÙÙ 
.
ÙÙ 
Token
ÙÙ 
=
ÙÙ 
token
ÙÙ 
;
ÙÙ 
db
ıı 
.
ıı 
token_compra
ıı 
.
ıı 
Add
ıı 
(
ıı 
compraDatos
ıı $
)
ıı$ %
;
ıı% &
db
ˆˆ 
.
ˆˆ 
SaveChanges
ˆˆ 
(
ˆˆ 
)
ˆˆ 
;
ˆˆ 
mensaje
¯¯ 
=
¯¯ 
true
¯¯ 
;
¯¯ 
}
˘˘ 
return
˚˚ 

mensaje
˚˚ 
;
˚˚ 
}
˝˝ 
}
˛˛ 
public
ÄÄ 
string
ÄÄ	 "
generaTokenAleatorio
ÄÄ $
(
ÄÄ$ %
)
ÄÄ% &
{
ÅÅ 	
var
ÇÇ 

characters
ÇÇ 
=
ÇÇ 
$str
ÇÇ \
;
ÇÇ\ ]
var
ÉÉ 
Charsarr
ÉÉ 
=
ÉÉ 
new
ÉÉ 
char
ÉÉ 
[
ÉÉ 
$num
ÉÉ 
]
ÉÉ 
;
ÉÉ 
var
ÑÑ 
random
ÑÑ 
=
ÑÑ 
new
ÑÑ 
Random
ÑÑ 
(
ÑÑ 
)
ÑÑ 
;
ÑÑ 
for
ÖÖ 
(
ÖÖ 
int
ÖÖ 
i
ÖÖ 
=
ÖÖ 
$num
ÖÖ 
;
ÖÖ 
i
ÖÖ 
<
ÖÖ 
Charsarr
ÖÖ 
.
ÖÖ  
Length
ÖÖ  &
;
ÖÖ& '
i
ÖÖ( )
++
ÖÖ) +
)
ÖÖ+ ,
{
ÜÜ 
Charsarr
áá 
[
áá 
i
áá 
]
áá 
=
áá 

characters
áá 
[
áá 
random
áá #
.
áá# $
Next
áá$ (
(
áá( )

characters
áá) 3
.
áá3 4
Length
áá4 :
)
áá: ;
]
áá; <
;
áá< =
}
àà 
var
ää 
resultString
ää 
=
ää 
new
ää 
String
ää  
(
ää  !
Charsarr
ää! )
)
ää) *
;
ää* +
return
åå 	
resultString
åå
 
;
åå 
}
çç 
}
éé 
}èè 